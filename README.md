# Entity Framework Core 8 experiments

This repository contains a collection of experiments exploring various features and capabilities of Entity Framework Core 8. The focus is on hands-on examples that demonstrate how to effectively leverage EF Core in different scenarios, covering logging, migrations, SQL functionality, client evaluation, JSON handling, and more. The following experiments are included:

1. Entity Framework Logging
	* Add a custom logger to capture EF Core logs.
	* Log sensitive data.
	* Hide sensitive information, like connection string passwords, in the logs.
2. Idempotent SQL Migrations
	* Create idempotent migrations for SQL objects (using a function example), ensuring safe re-execution without side effects.
3. SQL Function Experiments
	* Explore various ways of calling SQL functions from within EF Core, including testing different syntax and approaches.
4. Custom SQL Expressions
	* Integrate custom SQL expressions into EF Core queries, enabling more advanced database operations.
5. SQL Query Safety with FormattableString
	* Safeguard SQL queries executed with `FromSql` and `SqlQuery` by using `FormattableString` to prevent SQL injection risks.
6. Difference Between AsSingleQuery and AsSplitQuery
	* Investigate the difference between `AsSingleQuery` and `AsSplitQuery` for handling complex queries and their impact on performance and results.
7. Client Evaluation in Entity Framework
	* Experiment with client-side evaluation in EF Core, understanding its implications and performance considerations.
8. Working with JSON in Entity Framework \
	Experiment with JSON data in EF Core, exploring:
	* How to handle `null` in a JSON object.
	* EF Core’s use of `JSON_MODIFY` for updates.
	* Querying JSON with `JSON_QUERY` in Select and Where clauses.
9. Real SQL Queries for ExecuteDeleteAsync
	* Investigate the underlying SQL query generated by `ExecuteDeleteAsync` to understand its structure and performance.
10. Real SQL Queries for ExecuteUpdateAsync
	* Examine the real SQL queries generated by `ExecuteUpdateAsync`, including scenarios involving atomic changes to the database.
11. Entity Framework Logging in ASP.NET Core
	* Explore the logging features of Entity Framework in an ASP.NET Core application, and how to integrate custom logging solutions.
12. IDisposable and AddDbContext in ASP.NET Core
	* Investigate how the `IDisposable` pattern works in the context of `AddDbContext<>()` and its lifecycle in ASP.NET Core applications.
13. IDisposable and AddDbContextFactory in ASP.NET Core
	* Explore the behavior of `IDisposable` when using `AddDbContextFactory<>()` in ASP.NET Core, highlighting differences and best practices.

This repository serves as a resource for anyone interested in learning more about Entity Framework Core 8 and how to apply its features in practical scenarios. Each experiment is designed to provide insight into specific aspects of EF Core while encouraging exploration of best practices and performance considerations.


## Useful links:
* [User-defined function mapping](https://learn.microsoft.com/en-us/ef/core/querying/user-defined-function-mapping)
* [SQL Queries](https://learn.microsoft.com/en-us/ef/core/querying/sql-queries)
* [DbContext initialization](https://learn.microsoft.com/en-us/ef/core/dbcontext-configuration/)
* [AddDbContext is `ServiceLifetime.Scoped`](https://github.com/dotnet/efcore/blob/main/src/EFCore/Extensions/EntityFrameworkServiceCollectionExtensions.cs)
* [DI Disposal of services](https://learn.microsoft.com/en-us/aspnet/core/fundamentals/dependency-injection?view=aspnetcore-8.0#disposal-of-services)


## Used migrations:
```
dotnet ef migrations add Initial -c MyContext -o Migrations
dotnet ef migrations add AddFunctionGetOrderRevenue -c MyContext -o Migrations
```
